local userInputService = game:GetService("UserInputService")
local runService = game:GetService("RunService")
local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()

local noclip = false
local originalCollisions = {}
local screenGui

local function createUI()
    if player:FindFirstChild("PlayerGui"):FindFirstChild("NoclipUI") then
        player.PlayerGui.NoclipUI:Destroy()
    end

    screenGui = Instance.new("ScreenGui")
    screenGui.Name = "NoclipUI"
    screenGui.Parent = player:WaitForChild("PlayerGui")

    local function createLabel(text, position)
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0.1, 0, 0.05, 0)
        label.Position = position
        label.BackgroundTransparency = 0.5
        label.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
        label.TextColor3 = Color3.fromRGB(255, 255, 255)
        label.Font = Enum.Font.SourceSansBold
        label.TextScaled = true
        label.Text = text
        label.Parent = screenGui
        return label
    end

    local noclipLabel = createLabel("Noclip: OFF", UDim2.new(0.9, -150, 0, 10))
    local middleLabel = createLabel("Noclip: OFF", UDim2.new(0.8, 0, 0.5, -25))

    return noclipLabel, middleLabel
end

local noclipLabel, middleLabel = createUI()

local function toggleNoclip()
    if not character then return end

    noclip = not noclip

    if noclip then
        noclipLabel.Text = "Noclip: ON"
        middleLabel.Text = "Noclip: ON"

        for _, part in ipairs(character:GetChildren()) do
            if part:IsA("BasePart") then
                originalCollisions[part] = part.CanCollide
                part.CanCollide = false
            end
        end
    else
        noclipLabel.Text = "Noclip: OFF"
        middleLabel.Text = "Noclip: OFF"

        for part, canCollide in pairs(originalCollisions) do
            if part and part:IsA("BasePart") then
                part.CanCollide = canCollide
            end
        end
    end
end

userInputService.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == Enum.KeyCode.Y then
        toggleNoclip()
    end
end)

runService.Heartbeat:Connect(function()
    if noclip and character then
        for _, part in ipairs(character:GetChildren()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end
end)

player.CharacterAdded:Connect(function(newCharacter)
    character = newCharacter
    originalCollisions = {}
    noclip = false
    wait(1)
    noclipLabel, middleLabel = createUI()
end)
